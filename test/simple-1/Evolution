;; -*- mode: lisp -*-
(asdf:oos 'asdf:load-op :evol)

(defparameter *cc* "cc")
(defparameter *objects* '("main.o" "program.o"))

(defun do-objects ()
  (mapc #'(lambda (pathname)
            (evol:shell *cc* (evol:interpolate-commandline " -c -o %@ %<" pathname
                                                           #'(lambda (pathname)
                                                               (evol:pathname-change-suffix "c" pathname)))))
        *objects*))

(defun do-main ()
  (do-objects)
  (external-program:run *cc* `(,@*objects* "-o" "main")
                        :output *standard-output*))

(defun do-all ()
  (do-main))

(defun do-clean ()
  (external-program:run "rm" `("-f" ,@*objects* "main")
                        :output *standard-output*))
